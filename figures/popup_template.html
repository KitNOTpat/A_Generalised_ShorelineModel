<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Shoreline Prediction Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Georgia, serif;
            background: #f0f0f0;
            padding: 5px;
        }
        .chart-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .chart-box {
            background: white;
            padding: 5px;
            border-radius: 10px;
            margin: 0;
        }
        canvas {
            width: 100%;
            height: 300px;
        }
    </style>
</head>
<body>
    <h2 style="text-align: center;"><span id="transect-id"></span></h2>
    <div class="chart-row">
        <div class="chart-box" style="width: 800px;">
            <canvas id="shorelineChart"></canvas>
        </div>
        <div class="chart-box" style="width: 300px;">
            <canvas id="kdeChart"></canvas>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const transectId = urlParams.get('id');

        fetch(`./json/${transectId}.json`)
            .then(response => response.json())
            .then(data => {
                document.getElementById("transect-id").textContent = data.transect_id;

                // Shoreline chart
                const ctx1 = document.getElementById('shorelineChart').getContext('2d');
                new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: data.dates,

                        datasets: [
                            {
                                label: 'q11',
                                data: data.lower,
                                borderColor: 'transparent',
                                backgroundColor: data.rgb,
                                fill: '+1',
                                pointRadius: 0,
                                borderWidth: 0
                            },
                            {
                                label: 'q50',
                                data: data.prediction,
                                fill: false,
                                borderColor: data.color,
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false
                            },
                            {
                                label: 'Uncertainty (11â€“89%)',
                                data: data.upper,
                                borderColor: 'transparent',
                                backgroundColor: data.rgb,
                                fill: '-1',
                                pointRadius: 0,
                                borderWidth: 0
                            },
                            {
                                label: 'Ground Truth',
                                data: data.ground_truth,
                                borderColor: '#cccccc',
                                borderWidth: 1,
                                pointBackgroundColor: 'white',
                                pointBorderColor: 'black',
                                pointRadius: 2,
                                fill: false,
                                showLine: true,
                                spanGaps: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    // usePointStyle: true,
                                    // pointStyle: 'line',
                                    font: {
                                        style: 'italic'
                                    },
                                    filter: function(legendItem) {
                                        return legendItem.text !== 'q11';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Shoreline (m)' }
                            },
                            x: {
                                title: { display: false, text: 'Date' }
                            }
                        }
                    }
                });

                // KDE chart
                const kdeData = data.x_kde.map((x, i) => ({ x: x, y: data.y_kde[i] }));
                const ctx2 = document.getElementById('kdeChart').getContext('2d');
                new Chart(ctx2, {
                    type: 'line',
                    data: {
                        datasets: [
                            {
                                label: 'Current RMSE Point',
                                data: [{ x: data.rmse_val, y: data.rmse_density }],
                                backgroundColor: 'black',
                                pointRadius: 4,
                                type: 'scatter'
                            },
                            {
                                label: 'RMSE vline',
                                data: [
                                    { x: data.rmse_val, y: 0 },
                                    { x: data.rmse_val, y: data.rmse_density }
                                ],
                                borderColor: 'black',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                type: 'line',
                                showLine: true
                            },
                            {
                                label: 'RMSE KDE',
                                data: kdeData,
                                borderColor: data.color,
                                backgroundColor: data.rgb,
                                fill: true,
                                pointRadius: 0,
                                borderWidth: 2,
                                showLine: true,
                                type: 'line'
                            },

                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                title: { display: true, text: 'RMSE' },
                                min: Math.min(...data.x_kde),
                                // max: 2.5
                            },
                            y: {
                                title: { display: false },
                                min: 0,
                                max: Math.max(...data.y_kde) * 1.05
                            }
                        }
                    }
                });
            });
    </script>
</body>
</html>